# PROJECT.md ‚Äî Sofia Bot

> –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–Å –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

---

## ü§ñ CLAUDE: –°–¢–ê–†–¢ –°–ï–°–°–ò–ò

### 1. –ü—Ä–æ—á–∏—Ç–∞–π HANDOFF (–≤–Ω–∏–∑—É –¥–æ–∫—É–º–µ–Ω—Ç–∞)
–ü–æ–π–º–∏: —á—Ç–æ –≥–æ—Ä–∏—Ç, —á—Ç–æ —Å–¥–µ–ª–∞–ª–∏, —á—Ç–æ –¥–∞–ª—å—à–µ.

### 2. –ó–∞–≥—Ä—É–∑–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–¥

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
```
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/bot_server.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/sofia_prompt.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/sofia_analyzer.py
```

**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ:**
```
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/morning_ping.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/prompt_health.py
```

**–°–∫—Ä–∏–ø—Ç—ã –∞–Ω–∞–ª–∏–∑–∞:**
```
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/scripts/dialog_processor.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/scripts/batch_process.py
```

### 3. –°–∫–∞–∂–∏
"–ò–∑—É—á–∏–ª PROJECT.md –∏ –∫–æ–¥. [–°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ HANDOFF]. –ß—Ç–æ –¥–µ–ª–∞–µ–º?"

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞
| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä—É–µ–º` | –û–±–Ω–æ–≤–∏—Ç—å PROJECT.md (HANDOFF, TASKS, CHANGELOG) ‚Üí commit ‚Üí push |
| `–ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–æ–≤—ã–π —á–∞—Ç` | –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è + –≤—ã–¥–∞—Ç—å —Å—Å—ã–ª–∫—É: `https://raw.githubusercontent.com/semiekhin/sofia-bot/main/PROJECT.md` |

### –°—Ç–∞–Ω–¥–∞—Ä—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
–ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞: `DEV_STANDARD.md` –≤ —ç—Ç–æ–º —Ä–µ–ø–æ.
–ö—Ä–∞—Ç–∫–∞—è —Å—É—Ç—å: dev ‚Üí —Ç–µ—Å—Ç ‚Üí —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ‚Üí –¥–µ–ø–ª–æ–π prod ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí commit ‚Üí push ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å PROJECT.md

---

## üìã QUICK INFO

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ü—Ä–æ–µ–∫—Ç** | Sofia Bot ‚Äî AI-–ø—Ä–æ–¥–∞–∂–Ω–∏–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ |
| **–ö–æ–º–ø–∞–Ω–∏—è** | Oazis Estate |
| **–°—Ç–µ–∫** | Python 3.12, python-telegram-bot, OpenAI GPT-5.2, SQLite |
| **–í–µ—Ä—Å–∏—è** | 1.0.5 |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ Production |

### –°—Å—ã–ª–∫–∏

| –†–µ—Å—É—Ä—Å | URL |
|--------|-----|
| **GitHub** | https://github.com/semiekhin/sofia-bot |
| **PROJECT.md (raw)** | https://raw.githubusercontent.com/semiekhin/sofia-bot/main/PROJECT.md |
| **–°–µ—Ä–≤–µ—Ä** | `ssh -p 2222 root@72.56.64.91` |
| **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è** | `/opt/sofia-bot` |
| **–ë–æ—Ç** | @SofiaOazisBot |

### –í—Å–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞ (raw —Å—Å—ã–ª–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏)
```
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/bot_server.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/sofia_prompt.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/sofia_analyzer.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/morning_ping.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/prompt_health.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/scripts/dialog_processor.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/scripts/batch_process.py
https://raw.githubusercontent.com/semiekhin/sofia-bot/main/requirements.txt
```

---

## üîê –°–ï–ö–†–ï–¢–´

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/opt/sofia-bot/.env` (chmod 600, –Ω–µ –≤ git)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `OPENAI_API_KEY` | API –∫–ª—é—á OpenAI |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ |
| `ADMIN_CHAT_ID` | Chat ID –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

---

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

**–§–∞–π–ª:** `/opt/sofia-bot/sofia_conversations.db` (SQLite, –Ω–µ –≤ git)

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `messages` | –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ |
| `users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞ |
| `feedback_v2` | –û—Ü–µ–Ω–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

```sql
-- –°–æ–æ–±—â–µ–Ω–∏—è
CREATE TABLE messages (
    id INTEGER PRIMARY KEY,
    chat_id INTEGER,
    user_id INTEGER,
    user_name TEXT,
    role TEXT,           -- 'user' –∏–ª–∏ 'assistant'
    content TEXT,
    timestamp DATETIME,
    processed INTEGER
);

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY,
    chat_id INTEGER,
    user_name TEXT,
    first_contact DATETIME,
    last_message DATETIME,
    messages_count INTEGER
);

-- –û—Ü–µ–Ω–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
CREATE TABLE feedback_v2 (
    id INTEGER PRIMARY KEY,
    chat_id INTEGER,
    user_id INTEGER,
    expert_name TEXT,
    context TEXT,        -- JSON: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 8 —Å–æ–æ–±—â–µ–Ω–∏–π
    rating TEXT,         -- 'good' –∏–ª–∏ 'bad'
    comment TEXT,
    timestamp DATETIME
);
```

### –ü–æ–ª–µ–∑–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

```bash
sqlite3 /opt/sofia-bot/sofia_conversations.db
```

```sql
-- –î–∏–∞–ª–æ–≥–∏ —Å –¥–∞—Ç—ã
SELECT * FROM messages 
WHERE timestamp >= '2025-12-20' 
ORDER BY chat_id, timestamp;

-- –û—Ü–µ–Ω–∫–∏ —Å –¥–∞—Ç—ã
SELECT * FROM feedback_v2 
WHERE timestamp >= '2025-12-20' 
ORDER BY timestamp;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫
SELECT rating, COUNT(*) as cnt 
FROM feedback_v2 
WHERE timestamp >= '2025-12-20' 
GROUP BY rating;

-- GOOD rate
SELECT 
    ROUND(100.0 * SUM(CASE WHEN rating='good' THEN 1 ELSE 0 END) / COUNT(*), 1) as good_rate
FROM feedback_v2;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∏ —Å –æ—Ü–µ–Ω–∫–∞–º–∏
SELECT f.timestamp, f.expert_name, f.rating, f.comment
FROM feedback_v2 f
ORDER BY f.timestamp DESC
LIMIT 20;
```

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

```
Telegram ‚Üí bot_server.py ‚Üí GPT-5.2 ‚Üí –û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
                ‚îÇ
                ‚ñº
         sofia_prompt.py (–ø—Ä–æ–º–ø—Ç v3.5)
                ‚îÇ
                ‚ñº
      sofia_conversations.db (SQLite)
                ‚îÇ
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚ñº                 ‚ñº
 –û—Ü–µ–Ω–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤   22:00 cron
       ‚îÇ                 ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚ñº
        sofia_analyzer.py
                ‚îÇ
                ‚ñº
   –ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç ‚Üí —Ä–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `bot_server.py` | Telegram –±–æ—Ç, GPT, –∞–Ω—Ç–∏—Ñ–ª—É–¥, –æ—Ü–µ–Ω–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ |
| `sofia_prompt.py` | –ü—Ä–æ–º–ø—Ç v3.5: –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è, –∂–∏–≤–∞—è —Ä–µ—á—å, –æ–±—ä–µ–∫—Ç—ã —Å —Ü–µ–Ω–∞–º–∏ |
| `sofia_analyzer.py` | –ù–æ—á–Ω–æ–π –∞–Ω–∞–ª–∏–∑ (22:00) ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ ‚Üí —Ä–µ—Å—Ç–∞—Ä—Ç |
| `morning_ping.py` | –£—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º |
| `prompt_health.py` | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–æ–º–ø—Ç–∞ |
| `sofia_conversations.db` | SQLite: –¥–∏–∞–ª–æ–≥–∏, –æ—Ü–µ–Ω–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| `scripts/dialog_processor.py` | –ü–∞—Ä—Å–∏–Ω–≥ RTF/TXT + LLM-–æ—Ü–µ–Ω–∫–∞ –ø–æ 3 –Ω–∞–≤—ã–∫–∞–º |
| `scripts/batch_process.py` | –ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–∞–ø–∫–∏ –¥–∏–∞–ª–æ–≥–æ–≤ |
| `requirements.txt` | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
/opt/sofia-bot/
‚îú‚îÄ‚îÄ bot_server.py           # –ì–ª–∞–≤–Ω—ã–π –±–æ—Ç
‚îú‚îÄ‚îÄ sofia_prompt.py         # –ü—Ä–æ–º–ø—Ç v3.5
‚îú‚îÄ‚îÄ sofia_analyzer.py       # –ù–æ—á–Ω–æ–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ morning_ping.py         # –£—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚îú‚îÄ‚îÄ prompt_health.py        # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–æ–º–ø—Ç–∞
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ sofia_conversations.db  # SQLite –±–∞–∑–∞
‚îú‚îÄ‚îÄ .env                    # –°–µ–∫—Ä–µ—Ç—ã (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ PROJECT.md              # ‚Üê –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ DEV_STANDARD.md         # –°—Ç–∞–Ω–¥–∞—Ä—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ backups/                # –ë—ç–∫–∞–ø—ã –ø—Ä–æ–º–ø—Ç–æ–≤ (7 –¥–Ω–µ–π)
‚îú‚îÄ‚îÄ analyzer_logs/          # –õ–æ–≥–∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ dialog_processor.py # –ü–∞—Ä—Å–∏–Ω–≥ + LLM-–æ—Ü–µ–Ω–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ batch_process.py    # –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îî‚îÄ‚îÄ venv/                   # Python virtual environment
```

---

## ‚öôÔ∏è –£–ü–†–ê–í–õ–ï–ù–ò–ï

### –ë–æ—Ç
```bash
systemctl status sofia-bot
systemctl restart sofia-bot
journalctl -u sofia-bot -f
tail -f /opt/sofia-bot/sofia_bot.log
```

### –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)
```bash
cd /opt/sofia-bot
export $(cat .env | xargs) && python3 sofia_analyzer.py
```

### Git
```bash
cd /opt/sofia-bot
git add -A && git commit -m "vX.X.X: –æ–ø–∏—Å–∞–Ω–∏–µ" && git push
```

### Cron
```
0 22 * * * ‚Äî sofia_analyzer.py (—Å–∞–º–æ–æ–±—É—á–µ–Ω–∏–µ)
```

### –û—Ç–∫–∞—Ç –ø—Ä–æ–º–ø—Ç–∞
```bash
ls backups/
cp backups/sofia_prompt_XXXXXXXX.py sofia_prompt.py
systemctl restart sofia-bot
```

---

## üìä –ú–ï–¢–†–ò–ö–ò

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (2025-12-20)

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –¶–µ–ª—å | –°—Ç–∞—Ç—É—Å |
|---------|----------|------|--------|
| GOOD rate | 57% | 80% | üî¥ |
| –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è | 3.1/10 | ‚â•7 | üî¥ |
| –ó–∞–∫—Ä—ã—Ç–∏–µ | 6.1/10 | ‚â•7 | üü° |
| –í–æ–∑—Ä–∞–∂–µ–Ω–∏—è | 4.2/10 | ‚â•7 | üü° |

### –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
**95% –¥–∏–∞–ª–æ–≥–æ–≤ –±–µ–∑ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏.** –ë–æ—Ç —Å–ø–∞–º–∏—Ç –æ–±—ä–µ–∫—Ç–∞–º–∏, –Ω–µ –≤—ã—è—Å–Ω—è—è:
1. –¶–µ–ª—å (–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è / –¥–ª—è —Å–µ–±—è / —Å–¥–∞–≤–∞—Ç—å)
2. –õ–æ–∫–∞—Ü–∏—è (–°–æ—á–∏, –ö—Ä—ã–º, –ê–Ω–∞–ø–∞, –ê–ª—Ç–∞–π)
3. –ë—é–¥–∂–µ—Ç / –ø–ª–∞—Ç—ë–∂

---

## üö® –†–ò–°–ö–ò

| –†–∏—Å–∫ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-----------|
| –ü—Ä–æ–º–ø—Ç —Å–ª–æ–º–∞–ª—Å—è | –ë—ç–∫–∞–ø—ã –≤ `backups/`, –æ—Ç–∫–∞—Ç –≤—Ä—É—á–Ω—É—é |
| OpenAI rate limit | –ê–Ω—Ç–∏—Ñ–ª—É–¥ 3 —Å–µ–∫, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| –ë–æ—Ç —É–ø–∞–ª | systemd restart, –∞–ª–µ—Ä—Ç –≤ Telegram |
| –ö–ª–∏–µ–Ω—Ç —Ä–∞–∑–¥—Ä–∞–∂—ë–Ω | –ê–Ω—Ç–∏–ø–æ–≤—Ç–æ—Ä –≤ –ø—Ä–æ–º–ø—Ç–µ |
| –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | PROJECT.md + HANDOFF –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã |

### –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ö–æ–¥:** GitHub
- **–î–∞–Ω–Ω—ã–µ:** SQLite –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ + –±—ç–∫–∞–ø—ã
- **–ü—Ä–æ–º–ø—Ç:** `backups/` (7 –¥–Ω–µ–π)

### –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (5 –º–∏–Ω—É—Ç)

```bash
# –ë–æ—Ç —É–ø–∞–ª
systemctl restart sofia-bot
journalctl -u sofia-bot -f

# –ü—Ä–æ–º–ø—Ç —Å–ª–æ–º–∞–ª—Å—è
ls backups/
cp backups/sofia_prompt_XXXXXXXX.py sofia_prompt.py
systemctl restart sofia-bot
```

### –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ (30 –º–∏–Ω—É—Ç)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
apt update && apt install -y python3-venv python3-pip git ufw fail2ban

# 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
cd /opt
git clone git@github.com:semiekhin/sofia-bot.git sofia-bot
cd sofia-bot

# 3. –°–µ–∫—Ä–µ—Ç—ã
cat > .env << 'ENVEOF'
OPENAI_API_KEY=sk-...
TELEGRAM_BOT_TOKEN=...
ADMIN_CHAT_ID=512319063
ENVEOF
chmod 600 .env

# 4. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 5. Systemd
cat > /etc/systemd/system/sofia-bot.service << 'SVCEOF'
[Unit]
Description=Sofia Telegram Bot
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/sofia-bot
ExecStart=/opt/sofia-bot/venv/bin/python bot_server.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
SVCEOF

systemctl daemon-reload
systemctl enable sofia-bot
systemctl start sofia-bot

# 6. Cron (–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä 22:00)
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å:
# 0 22 * * * cd /opt/sofia-bot && export $(cat .env | xargs) && python3 sofia_analyzer.py >> analyzer.log 2>&1

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞
systemctl status sofia-bot
```

### –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- –°–µ—Ä–≤–µ—Ä –≤ –°–®–ê ‚Äî OpenAI —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é
- Telegram ‚Äî –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

---

## üìù TASKS

### üî• –°–µ–π—á–∞—Å
- [ ] –£—Å–∏–ª–∏—Ç—å –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ –ø—Ä–æ–º–ø—Ç–µ ‚Äî Sofia –î–û–õ–ñ–ù–ê –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å skill-based –æ—Ü–µ–Ω–∫—É –≤ —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏–µ

### üìã Backlog
- [ ] GOOD rate 57% ‚Üí 80%
- [ ] RAG –∫–æ–≥–¥–∞ –ø—Ä–æ–º–ø—Ç > 15k —Ç–æ–∫–µ–Ω–æ–≤
- [ ] Fine-tuning –ø—Ä–∏ 500+ GOOD –¥–∏–∞–ª–æ–≥–æ–≤

### ‚úÖ –°–¥–µ–ª–∞–Ω–æ
- [x] v1.0.5: Skill-based assessment
- [x] v1.0.4: –ü—Ä–æ–º–ø—Ç v3.5 ‚Äî –∂–∏–≤–∞—è —Ä–µ—á—å, —Ü–µ–Ω—ã
- [x] v1.0.3: Word-–æ—Ç—á—ë—Ç—ã, .env
- [x] v1.0.0: –°–∞–º–æ–æ–±—É—á–µ–Ω–∏–µ 22:00

---

## üõ†Ô∏è –ò–ù–°–¢–†–£–ú–ï–ù–¢–´

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤ –∏–∑ CRM

–û—Ç–∫—Ä–æ–π –¥–∏–∞–ª–æ–≥ –≤ CRM ‚Üí F12 ‚Üí Console ‚Üí –≤—Å—Ç–∞–≤—å:

```javascript
let messages = [];
let currentDate = '';

document.querySelectorAll('.message-list__message-group-date, .base-message__message').forEach(el => {
    if (el.classList.contains('message-list__message-group-date')) {
        currentDate = el.innerText?.trim() || '';
    } else {
        let author = el.querySelector('.base-message__message-author .text-main')?.innerText?.trim() || '';
        let text = el.querySelector('.base-message__message-body .text-main')?.innerText?.trim() || '';
        let time = el.querySelector('.base-message__message-time time')?.innerText?.trim() || '';
        
        if (!text) return;
        if (text === author) return;
        if (text.length < 3 && !text.match(/^(–¥–∞|–æ–∫|–Ω–µ—Ç)$/i)) return;
        
        let [h, m] = (time || '00:00').split(':').map(Number);
        messages.push({ date: currentDate, time, minutes: h * 60 + m, author, text });
    }
});

let groups = {};
messages.forEach(m => {
    if (!groups[m.date]) groups[m.date] = [];
    groups[m.date].push(m);
});

let dates = Object.keys(groups).reverse();
let result = [];

dates.forEach(date => {
    groups[date].sort((a, b) => a.minutes - b.minutes);
    groups[date].forEach(m => {
        result.push(`[${m.date} ${m.time}] ${m.author}: ${m.text}`);
    });
});

copy(result.join('\n\n'));
console.log('‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –°–æ–æ–±—â–µ–Ω–∏–π: ' + result.length);
```

---

## üë• –¢–ï–°–¢–ò–†–û–í–©–ò–ö–ò

- **–û–∫—Å–∞–Ω–∞** ‚Äî –≥–ª–∞–≤–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç (–ê–∫–∞–¥–µ–º–∏—è –ë–µ–ª–æ—á–∫–∏–Ω–æ–π)
- –ì—É–ª—å–Ω–∞—Ä–∞, –õ–µ—Å—è, –î–∞—Ä—å—è, –≠–º–∏–ª–∏—è, –í–ª–∞–¥–∏–º–∏—Ä, –ê–Ω–∞—Å—Ç–∞—Å–∏—è, –ê–ª–µ–∫—Å–∞–Ω–¥—Ä

---

## üó£Ô∏è –¢–ï–†–ú–ò–ù–´ –°–û–§–ò–ò

| ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ | ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ |
|----------------|--------------|
| –ø–æ–¥ —Å–¥–∞—á—É | –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ |
| —Å–¥–∞—á–∞ –¥–æ–º–∞ | —Å—Ä–æ–∫ –≤–≤–æ–¥–∞ / –ø–µ—Ä–µ–¥–∞—á–∞ –∫–ª—é—á–µ–π |
| –¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç | —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç |
| —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç | –ø–æ—Ä—è–¥–∫–∞ X –º–∏–ª–ª–∏–æ–Ω–æ–≤ |
| –¥–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è | –∫–æ—Ä–æ—Ç–∫–∏–µ, —ë–º–∫–∏–µ |

---

## üìà –ü–û–†–û–ì–ò –ú–ï–¢–†–ò–ö

| –ú–µ—Ç—Ä–∏–∫–∞ | üü¢ –ù–æ—Ä–º–∞ | üü° –í–Ω–∏–º–∞–Ω–∏–µ | üî¥ –ü—Ä–æ–±–ª–µ–º–∞ |
|---------|----------|-------------|-------------|
| GOOD rate | > 80% | 65-80% | < 65% |
| –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è | > 7/10 | 5-7 | < 5 |
| –ó–∞–∫—Ä—ã—Ç–∏–µ | > 7/10 | 5-7 | < 5 |
| –¢–æ–∫–µ–Ω—ã –ø—Ä–æ–º–ø—Ç–∞ | < 8k | 8-15k | > 15k |

---

## üìú CHANGELOG

### v1.0.5 (2025-12-20)
- –°–∏—Å—Ç–µ–º–∞ skill-based assessment (–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è, –∑–∞–∫—Ä—ã—Ç–∏–µ, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è)
- –°–∫—Ä–∏–ø—Ç—ã `dialog_processor.py`, `batch_process.py`
- –ê–Ω–∞–ª–∏–∑ 40 –¥–∏–∞–ª–æ–≥–æ–≤: –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è 3.1, –∑–∞–∫—Ä—ã—Ç–∏–µ 6.1, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è 4.2
- PROJECT.md + DEV_STANDARD.md

### v1.0.4 (2025-12-18)
- –ü—Ä–æ–º–ø—Ç v3.5: –∂–∏–≤–∞—è —Ä–µ—á—å, —Å–ª–æ–≤–∞—Ä—å –∑–∞–º–µ–Ω
- –ë–∞–∑–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —Å —Ü–µ–Ω–∞–º–∏

### v1.0.3 (2025-12-17)
- Word-–æ—Ç—á—ë—Ç—ã
- –°–µ–∫—Ä–µ—Ç—ã –≤ .env

### v1.0.0 (2025-12-11)
- –ê–≤—Ç–æ–∞–Ω–∞–ª–∏–∑ GPT-5.1 (cron 22:00)
- prompt_health.py, morning_ping.py

### v0.1 (2025-12-10)
- MVP: –±–æ—Ç + –ø—Ä–æ–º–ø—Ç + –æ—Ü–µ–Ω–∫–∏

---

## üîÑ HANDOFF

> –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–µ—Å—Å–∏—è: 2025-12-20

### –ß—Ç–æ –≥–æ—Ä–∏—Ç
- –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è 3.1/10 ‚Äî **–∫—Ä–∏—Ç–∏—á–Ω–æ**
- 95% –¥–∏–∞–ª–æ–≥–æ–≤ –±–µ–∑ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
- –ò–∑—É—á–∏–ª–∏ –≤—Å—é –∫–æ–¥–æ–≤—É—é –±–∞–∑—É
- –°–æ–∑–¥–∞–ª–∏ DEV_STANDARD.md (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
- –°–æ–∑–¥–∞–ª–∏ PROJECT.md (–ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É)
- –°–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –≤ –ø–∞–º—è—Ç—å Claude

### –ß—Ç–æ –Ω–µ —É—Å–ø–µ–ª–∏
- –£—Å–∏–ª–∏—Ç—å –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ –ø—Ä–æ–º–ø—Ç–µ
- –°–æ–∑–¥–∞—Ç—å —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
- –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å PROJECT.md –∏ DEV_STANDARD.md –≤ —Ä–µ–ø–æ

### –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥
1. –ó–∞–ª–∏—Ç—å PROJECT.md –∏ DEV_STANDARD.md –≤ —Ä–µ–ø–æ
2. –£—Å–∏–ª–∏—Ç—å –±–ª–æ–∫ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ sofia_prompt.py

### –ö–æ–Ω—Ç–µ–∫—Å—Ç
- –ï—Å—Ç—å 2 —Ö–æ—Ä–æ—à–∏—Ö –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞: –î–º–∏—Ç—Ä–∏–π –û–∞–∑–∏—Å, 79246903398
- –°–æ—Ñ–∏—è –¥–æ–ª–∂–Ω–∞ –í–°–ï–ì–î–ê –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –æ–±—ä–µ–∫—Ç–æ–≤
- –ë–æ—Ç –Ω–∞ –ø—Ä–æ–¥–µ ‚Äî –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-12-20*
